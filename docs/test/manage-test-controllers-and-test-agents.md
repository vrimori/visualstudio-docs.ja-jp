---
title: Visual Studio でのテスト コントローラーとテスト エージェントの管理
ms.date: 09/18/2018
ms.prod: visual-studio-dev15
ms.technology: vs-ide-test
ms.topic: conceptual
author: gewarren
ms.author: gewarren
manager: douge
ms.workload:
- multiple
ms.openlocfilehash: 48c377a8a5c48db7e0726ab5d5cc238e6b83c71c
ms.sourcegitcommit: ae46be4a2b2b63da7e7049e9ed67cd80897c8102
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2018
ms.locfileid: "52895289"
---
# <a name="manage-test-controllers-and-test-agents"></a>テスト コントローラーとテスト エージェントの管理

Visual Studio を使用してテストをリモートで実行する、複数のコンピューターにテストを配置する、またはロード テストを実行する場合は、テスト コントローラー、テスト エージェント、およびテストの設定ファイルを構成する必要があります。 このトピックでは、初めてテスト コントローラーとテスト エージェントをインストールおよび構成した後に、それらを管理する方法について説明します。

[!INCLUDE [web-load-test-deprecated](includes/web-load-test-deprecated.md)]

Microsoft Test Manager を使用してラボ環境でテストを実行する場合、Microsoft Test Manager の **[ラボ センター]** の **[テスト コントローラー マネージャー]** を使用して、テスト コントローラーとそのエージェントを管理します。 このトピックは、テストの実行に Visual Studio を使用する場合にのみ該当します。

Visual Studio でテストを実行するために、テスト エージェントとテスト コントローラーをインストールする方法および構成する方法の詳細については、[テスト エージェントとコントローラーの構成](../test/configure-test-agents-and-controllers-for-load-tests.md)に関するページを参照してください。

テスト コントローラーと登録されているエージェントを構成および監視するには、実行するテストが含まれているテスト プロジェクトにテスト設定ファイルを置いておく必要があります。 テスト設定ファイルで **[ロール]** を選択し、**[コントローラー]** フィールドのドロップダウンから **[テスト コントローラーの管理]** を選択します。

ロード テスト プロジェクトでは、**[ロード テスト]** メニューから **[テスト コントローラーの管理]** を選択することもできます。

## <a name="add-a-test-agent-to-a-test-controller"></a>テスト コントローラーへのテスト エージェントの追加

テスト エージェントを別のテスト コントローラーに追加したり、インストールしたテスト コントローラーにテスト エージェントを追加したりすることができます。

### <a name="to-add-a-test-agent-to-a-test-controller"></a>テスト コントローラーにテスト エージェントを追加するには

1. **[スタート]** > **[Test Agent 構成ツール]** の順に選択します。

     **[Test Agent の構成]** ダイアログ ボックスが表示されます。

    > [!NOTE]
    > テスト エージェントがインストールされ、テスト コントローラーに追加されている必要があります。 テスト エージェントのインストール方法の詳細については、「[テスト エージェントをインストールして構成する](../test/lab-management/install-configure-test-agents.md)」を参照してください。

2. テスト エージェントを実行するための 2 つのオプションが提示されます。

   - **[サービス]** デスクトップと対話する自動テスト (コード化された UI テスト、テスト実行時のビデオ記録の作成など) を実行する必要がない場合は、**[テスト エージェントの実行モード]** の **[サービス]** を選択します。 テスト エージェントがサービスとして起動されます。 **[次へ]** をクリックします。

      ここで、テスト エージェントをサービスとして起動するときのユーザーに関する詳細を入力できます。

      1. **[ユーザー名]** に名前を入力します。

      2. **[パスワード]** にパスワードを入力します。

        |**ユーザー アカウントに関する重要な情報**|
        |-|
        |-   ユーザー アカウントに null パスワードは使用できません。|
        |-   IntelliTrace コレクターまたはネットワーク エミュレーションを使用するには、ユーザー アカウントが Administrators グループのメンバーである必要があります。|
        |-   エージェント ユーザー名がエージェント サービスにない場合は、そのユーザー名を追加しようとするので、テスト コントローラーに対するアクセス許可が必要です。|
        |-   テスト コントローラーを使用するユーザーは、テスト コントローラーの Users アカウントに属している必要があります。属していないと、コントローラーに対してテストを実行できません。|

   - **[対話型プロセス]**: デスクトップと対話する必要がある自動テスト (コード化された UI テスト、テスト実行時のビデオ記録の作成など) を実行する場合は、**[対話型プロセス]** を選択します。 テスト エージェントは、サービスではなく対話型プロセスとして起動されます。

      次のページで、テスト エージェントをプロセスとして開始するときのユーザーに関する詳細を入力したり、その他のオプションを選択したりできます。

      1. **[ユーザー名]** に名前を入力します。

      2. **[パスワード]** にパスワードを入力します。

        > [!NOTE]
        > 現在アクティブなユーザーではない別のユーザーを使用して対話型のプロセスとして実行するようにテスト エージェントを構成した場合、エージェントを起動するには、コンピューターを再起動し、この異なるユーザーとしてログオンする必要があります。 また、ユーザー アカウントに null パスワードは使用できません。 IntelliTrace コレクターまたはネットワーク エミュレーションを使用するには、ユーザー アカウントが Administrators グループのメンバーである必要があります。

      3. テスト エージェントが構成されたコンピューターで、コンピューターの再起動後にテストを確実に実行できるようにするには、テスト エージェント ユーザーとして自動的にログオンするようにコンピューターを設定します。 **[自動的にログオンする]** をオンにします。 これで、ユーザー名とパスワードが暗号化された形式でレジストリに保存されます。

      4. スクリーン セーバーはデスクトップと対話する必要がある自動テストに干渉する可能性があるため、スクリーン セーバーを確実に無効にするには、**[スクリーン セーバーを無効にする]** をオンにします。

        > [!WARNING]
        > 自動的にログオンする、またはスクリーン セーバーを無効にすると、セキュリティ上のリスクが生じます。 自動ログオンを有効にすると、他のユーザーがこのコンピューターを起動して、自動ログオンするアカウントを使用できるようになります。 スクリーン セーバーを無効にすると、コンピューターのロックを解除するためにユーザーのログオンを要求するプロンプトが表示されなくなる可能性があります。 この結果、コンピューターに物理的にアクセスできれば、だれでもコンピューターを使用できるようになります。 これらの機能をコンピューターで有効にする場合は、これらのコンピューターが物理的に安全であることを確認してください。 たとえば、これらのコンピューターを物理的に安全なラボに設置するなどの措置を講じます。 **[スクリーン セーバーを無効にする]** をオフにしても、この操作だけではスクリーン セーバーは有効になりません。

3. このエージェントを別のテスト コントローラーに登録するには、**[テスト コントローラーに登録する]** を選択します。 **[次のテスト コントローラーにテスト エージェントを登録する]** に、使用しているテスト コントローラーの名前と、その後にコロン (**:**) およびポート番号を入力します。 たとえば、「**agent1:6901**」と入力します。

    > [!NOTE]
    > 既定のポート番号は 6901 です。

4. 変更を保存するには、**[設定の適用]** を選択します。 **[構成の概要]** のダイアログ ボックスを閉じ、**Test Agent 構成ツール**を閉じます。

> [!WARNING]
> エージェントが現在別のテスト コントローラーに対して実行するように構成されている場合は、テスト エージェントをそのコントローラーから削除する必要があります。

## <a name="remove-a-test-agent-from-a-test-controller"></a>テスト コントローラーからのテスト エージェントの削除

テスト エージェントを削除するには、テスト エージェントをオフライン状態に設定しておく必要があります。

> [!NOTE]
> この手順を使用して、ラボ環境の一部としてコントローラーに登録されているエージェントを削除することはできません。 これらのエージェントをコントローラーから削除するには、Microsoft Test Manager を使用して環境を削除する必要があります。

### <a name="to-remove-a-test-agent-from-a-test-controller"></a>テスト コントローラーからテスト エージェントを削除するには

1. テスト コントローラーがプロジェクトに登録されていない場合は、次の手順を行います。

    1. Visual Studio から、テスト プロジェクトのテスト設定ファイルを開いて **[ロール]** を選択し、**[コントローラー]** フィールドのドロップダウンから **[テスト コントローラーの管理]** を選択します。

         **[テスト コントローラーの管理]** ダイアログ ボックスが表示されます。

    2. **[コントローラー]** ドロップダウン リストに、テスト コントローラーをセットアップしたコンピューターの名前を入力します。 以前に特定のテスト コントローラーを管理したことがある場合は、その名前をボックスの一覧から選択できます。

    3. **[エージェント]** ウィンドウで、テスト エージェントの名前を選択します。 エージェントがオンラインの場合は、**[オフライン]** を選択します。 テスト エージェントを削除するには、**[削除]** を選択してください。

        > [!NOTE]
        > テスト エージェントを削除しても、そのテスト エージェントとテスト コントローラーの関連付けが解除されるだけです。 テスト エージェントを完全にアンインストールする場合は、テスト エージェント コンピューターの [コントロール パネル] の **[プログラムと機能]** を使用します。

2. テスト コントローラーがプロジェクトに登録されている場合は、Microsoft Test Manager を使用してエージェントを削除します。

## <a name="change-the-settings-for-a-test-agent"></a>テスト エージェントの設定の変更

テスト エージェントの状態は次のいずれかの値になります。

|Status|説明|
|-|-----------------|
|テストの実行中|テストを実行しています。|
|準備完了|テストの実行またはデータおよび診断情報を収集できる状態です。|
|オフライン|テストの実行またはデータおよび診断情報を収集できない状態です。|
|切断|テスト エージェントは起動されていません。|

テスト エージェントの状態およびその他の設定を変更するには、次の手順を実行します。

### <a name="to-change-the-settings-of-a-test-agent"></a>テスト エージェントの設定を変更するには

> [!NOTE]
> テスト エージェントが、プロジェクトに登録されているテスト コントローラーに登録されている場合は、Microsoft Test Manager で設定を変更します。

1. ロード テストのテスト コントローラーと登録されているエージェントを構成および監視するには、Visual Studio で **[ロード テスト]** メニューを選択し、**[テスト コントローラーの管理]** をポイントします。 他のテストの場合は、Visual Studio でテスト プロジェクトのテスト設定ファイルを開いて **[ロール]** を選択し、**[コントローラー]** フィールドのドロップダウンから **[テスト コントローラーの管理]** を選択します。

   **[テスト コントローラーの管理]** ダイアログ ボックスが表示されます。

1. テスト コントローラーの一覧で、変更するテスト エージェントを含むテスト コントローラーの名前を選択します。 該当するテスト コントローラーが一覧に表示されない場合、テスト コントローラーが正しく登録されていることを確認します。 詳細については、テスト コントローラーの構成方法に関する次の手順を参照してください。

1. (省略可能) **[テスト エージェント]** ウィンドウで、プロパティを変更するテスト エージェントのコンピューターを選択します。

1. **[プロパティ]** を選択します。

1. 次のテスト エージェントのプロパティを必要に応じて変更します。

|Test Agent プロパティ|説明|
|-|-----------------|
|**重み付け**|テスト エージェントをさまざまなパフォーマンス レベルで使用するときに、負荷を分散するために使用されます。 たとえば、ウェイトが 100 のテスト エージェントには、ウェイトが 50 のテスト エージェントに比べて 2 倍の負荷が加わります。|
|**IP 切り替え**|IP スイッチを構成するために使用されます。 IP 切り替えを使用すると、テスト エージェントで IP アドレスの範囲を使用してサーバーに要求を送信できます。 これにより、異なるクライアント コンピューターからの呼び出しをシミュレートできます。<br /><br /> IP 切り替えは、ロード テストが Web ファームにアクセスしている場合に重要です。 ほとんどの負荷分散機能では、クライアントと特定の Web サーバーとの間の関係を確立するのに、クライアントの IP アドレスを使用します。 すべての要求が単一のクライアントから送信されているように見える場合、負荷分散機能は負荷の分散を実行しません。 Web ファームで適切な負荷分散を得るには、要求が一定の範囲の IP アドレスから送信されることを確認します。 **注:** ネットワーク アダプターを指定するか、**[(すべて未割り当て)]** を使用して、現在使用されていないネットワーク アダプターを自動的に選択できます。 <br /><br /> IP 切り替え機能を使用するには、Visual Studio Test Agent サービスがそのエージェント コンピューターの Administrators グループのユーザーとして実行されている必要があります。 このユーザーはエージェントのセットアップ中に選択されますが、サービスのプロパティを変更し、サービスを再開すると変更できます。<br /><br /> IP 切り替え機能が正しく機能していることを確認するには、Web サーバーで IIS ログを有効にし、IIS ログ機能を使用して、設定した IP アドレスから要求が届いていることを確認します。|
|**属性**|テスト エージェントの選択で使用できる名前と値のペアです。 たとえば、テストでは特定の OS を必要とする場合があります。 テストの設定ファイルの **[ロール]** のタブに属性を追加し、一致する属性があるテスト エージェントを選択するために使用できます。 複数のコンピューターでテストを実行する場合は、テストを実行するように構成したテストの設定ロールに属性を作成し、そのロールで使用する各テスト エージェントに一致する属性を構成します。 **注:** この設定は、プロジェクトに登録されていないテスト コントローラーに登録されているテスト エージェントでのみ使用できます。これらの属性は、Visual Studio のテストの設定でのみ使用されます。|

テスト エージェントのウェイトおよびテスト エージェントの属性の変更は、即座に有効になりますが、実行中のテストには影響しません。 [IP アドレス範囲] は、テスト コントローラーの再起動後に有効になります。

(省略可能) テスト エージェントの状態を変更するには、一覧でエージェントを選択し、エージェントの現在の状態に基づいて選択できる項目からアクションを選択します。

> [!NOTE]
> テスト エージェントがプロセスとして実行されている場合は、テスト エージェントがインストールされているコンピューターで実行されているテスト エージェントの状態を、通知領域アイコンから管理します。 これは、テスト エージェントの状態を示します。 このツールを使用してエージェントがプロセスとして実行されている場合は、エージェントを起動、停止、または再起動できます。

## <a name="configure-a-test-controller"></a>テスト コントローラーの構成

テスト コントローラーを構成するには、**Team Test Controller 構成ツール**を使用する必要があります。 テスト コントローラーを構成するときに、テスト コントローラーを別のプロジェクト コレクションに登録したり、プロジェクト コレクションへのテスト コントローラーの登録を解除したりできます。

テスト コントローラーを Team Foundation Server プロジェクト コレクションに登録する場合は、テスト コントローラー サービスに使用するアカウントがプロジェクト コレクションのプロジェクト コレクション テスト サービス アカウント グループのメンバーであるか、またはテスト コントローラー構成ツールを実行するために使用するアカウントがプロジェクト コレクション管理者である必要があります。

> [!NOTE]
> プロジェクト コレクションに既存の環境を持つテスト コントローラーをプロジェクト コレクションから登録解除しても、プロジェクト コレクションを移動し、その移動したプロジェクト コレクションにテスト コントローラーを再登録した場合、環境は維持されます。

### <a name="to-configure-a-test-controller"></a>テスト コントローラーを構成するには

1. いつでもツールを使用してテスト コントローラーを再構成するには、**[スタート]** > **[Test Controller 構成ツール]** の順に選択します。

     **[テスト コントローラーの構成]** ダイアログ ボックスが表示されます。

2. テスト コントローラー サービスのログオン アカウントとして使用するユーザーを選択します。

    > [!NOTE]
    > ユーザー アカウントに null パスワードは使用できません。

4. (省略可能) ラボ環境でテスト コントローラーを使用せず、Visual Studio からのみテストを実行する場合は、**[Register test controller with Team Project Collection]\(チーム プロジェクト コレクションにテスト コントローラーを登録する\)** をオフにします。

5. (省略可能) ロード テスト用にテスト コントローラーを構成するには、**[Configure test controller for load testing]\(ロード テスト用にテスト コントローラーを構成する\)** をオンにします。 **[次の SQL Server インスタンスにロード テスト結果のデータベースを作成する]** に SQL Server のインスタンスを入力します。

> [!NOTE]
> テスト コントローラーのトラブルシューティングの詳細については、「[テスト エージェントをインストールして構成する](../test/lab-management/install-configure-test-agents.md)」を参照してください。

## <a name="manage-your-agents-when-you-run-your-tests-with-a-test-controller"></a>テスト コントローラーを使用したテストの実行時のエージェントの管理

アプリケーションのロールを Visual Studio のテストの設定に追加する際、各ロールのエージェント プロパティを追加できます。 これは、どのテスト エージェントがこのロールに対して使用できるかを決定します。 これらのテスト設定を使用してテストを実行すると、テスト設定用に選択されたテスト コントローラーによって、必要なエージェントを使用できるかどうかが判断されます。 エージェントを使用できるかどうかの判断が必要になる状況は、次のとおりです。

-   テストの実行が必要なロールに対して、使用できるエージェントがない場合:  テストを実行できません。 次のいずれかの処理を行って、再度、テストを実行します。

    -   テストを実行するこのロールに対するエージェントが、使用できるようになるまで待ちます。

    -   このロールに対して使用できるオフラインのエージェントがある場合は、エージェントを再起動して使用できるようにします。

    -   このロールの正しいエージェント プロパティを指定した別のエージェントを、テスト コントローラーに追加できます。

    -   テストの設定でこのロールのエージェント プロパティを変更して、使用する他のエージェントを有効にします。

-   診断データ アダプターを実行する 1 つまたは複数のロールに対して、使用できるエージェントがない場合:  テストは実行できますが、診断データ アダプターは実行できません。 診断データ アダプターなしでテストを実行するか、次のいずれかの処理を行って、再度、テストを実行します。

    -   これらのロールに対するエージェントが、使用できるようになるまで待ちます。

    -   このロールに使用できるオフラインのエージェントがある場合は、**[テスト]** メニューの **[テスト コントローラーの管理]** からエージェントの状態をオンラインに変更してください。 また、エージェントがコントローラーから切断されている場合は、エージェントの再起動が必要になることがあります。

    -   このテストの実行に必要なエージェントが、テストの実行でビジーになっていないことを確認します。 **[テスト]** メニューの **[テスト コントローラーの管理]** から、エージェントの状態を確認できます。

    -   このロールの正しいエージェント プロパティを指定した別のエージェントを、テスト コントローラーに追加できます。

    -   テストの設定でこのロールのエージェント プロパティを変更して、使用する他のエージェントを有効にします。

## <a name="load-tests-from-delay-signed-assemblies"></a>遅延署名されたテスト アセンブリからのテストの読み込み

テスト コントローラーおよびテスト エージェントは、厳密な名前で署名されたアセンブリまたは署名なしのアセンブリからのみ、ロード テスト アセンブリを読み込むことができます。 一部のテスト アセンブリは、アプリケーションの運用アセンブリにアクセスする必要があるため、遅延署名されています。 ただし、これらのアセンブリはテスト アセンブリであり、配布されることはないため、厳密な名前では署名されません。 これらのアセンブリは遅延署名されているため、読み込むことができません。そのため、これらのアセンブリを読み込むすべてのコンピューター (テスト コントローラーのコンピューターを含む) で、これらのアセンブリに対して厳密な名前の検証を無効にする必要があります。 遅延署名の検証を無効にするには、*sn.exe* を使用します。 厳密な名前の検証をスキップする遅延署名されたアセンブリの公開キー トークンを含める必要がある場合もあります。

*Sn.exe* (厳密名ツール) を使用して、遅延署名の検証を無効にします。

これにより、コマンドを実行したコンピューターで、指定したアセンブリについてのみ、厳密な名前の検証が無効になります。 これを行うには、適切なアクセス許可が必要です。

テスト実行が完了したら、*SN.exe* コマンドを使用して遅延署名の検証を再度有効にします。

署名の検証の無効化と再有効化を行う場合は、スクリプトで *SN.exe* コマンドを使用することをお勧めします。 セットアップ スクリプトで検証を無効にし、後処理用スクリプトで再び有効にできます。

## <a name="see-also"></a>関連項目

- [テスト エージェントをインストールして構成する](../test/lab-management/install-configure-test-agents.md)