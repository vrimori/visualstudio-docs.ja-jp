---
title: Visual Studio でのロード テスト用のカウンター セットとしきい値規則 | Microsoft Docs
ms.date: 10/19/2016
ms.topic: article
helpviewer_keywords:
- counters, counter sets
- load tests, thresholds
- counter sets
- load tests, performance
- load tests, counter sets
- load tests, threshold rules
ms.assetid: 9e14d955-f3a4-4717-bbfe-7f08cdda5678
author: gewarren
ms.author: gewarren
manager: ghogen
ms.technology: vs-ide-test
ms.openlocfilehash: a573e883a4d5557a4812e6f38ae63fc1b1d71425
ms.sourcegitcommit: 900ed1e299cd5bba56249cef8f5cf3981b10cb1c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2018
---
# <a name="specify-counter-sets-and-threshold-rules-for-computers-in-a-load-test"></a>ロード テストでのコンピューターのカウンター セットとしきい値規則を指定する

ロード テストでは、名前付きカウンター セットが提供されており、パフォーマンス カウンター データを分析する際に役立ちます。 カウンター セットはテクノロジ単位で整理されており、アプリケーション、ASP.NET、.NET アプリケーション、IIS、SQL などがあります。 **新しいロード テスト ウィザード**を使用してロード テストを作成するときに、初期カウンター セットを追加します。 これらによって、定義済みの重要なカウンター セットがロード テスト用に提供されます。 カウンターは、**ロード テスト エディター**で管理します。

> [!NOTE]
> ロード テストを複数のリモート コンピューターに分散する場合、コントローラーとエージェント カウンターが、コントローラーとエージェント カウンター セットに割り当てられます。 ロード テストでリモート コンピューターを使用する方法の詳細については、「[テスト コントローラーとテスト エージェント](configure-test-agents-and-controllers-for-load-tests.md)」を参照してください。

カウンター セットは、指定したコンピューターで収集されます。 カウンター セットとロード テスト中に使用されるコンピューターとの関連付けは、*カウンター セット マップ*です。 たとえば、テストしている Web サーバーに ASP.NET、IIS、および .NET アプリケーション カウンター セットのマップがあるとします。

既定では、パフォーマンス カウンターはコントローラーおよびエージェントで収集されます。 詳細については、「[テスト コントローラーとテスト エージェント](configure-test-agents-and-controllers-for-load-tests.md)」を参照してください。

テストしているサーバーを、カウンターを収集するコンピューターの一覧に追加することが重要です。 これにより、ロード テスト中に、重要なシステム データが収集および監視されます。

## <a name="tasks"></a>[タスク]

|[タスク]|関連するトピック|
|-----------|-----------------------|
|**ロード テストのカウンター セットを管理する:** ロード テストを作成した後で、ロード テスト エディターでカウンター セットを編集できます。 カウンター セットの管理では、パフォーマンス データの収集元となるコンピューター セットの選択や、個々のコンピューターから収集するカウンター セットの割り当てなどを行います。 カウンターは、ロード テスト エディターで管理します。|-   [方法: カウンター セットを管理する](../test/how-to-manage-counter-sets-using-the-load-test-editor.md)|
|**ロード テストにカウンター セットを追加する:** 新しいロード テスト ウィザードを使用してロード テストを作成する場合、初期のカウンター セットを追加します。 これらによって、定義済みのカウンター セットがロード テスト用に提供されます。 ロード テストを作成すると、ロード テスト エディターを使用して既存のカウンター セットに新しいカウンターを追加できます。|-   [方法 : カウンターをカウンター セットに追加する](../test/how-to-add-counters-to-counter-sets-using-the-load-test-editor.md)<br />-   [方法 : カスタム カウンター セットを追加する](../test/how-to-add-custom-counter-sets-using-the-load-test-editor.md)|
|**ロード テストのカウンターを使用してしきい値規則を指定する:** しきい値規則とは、ロード テスト中にシステム リソースの使用率を監視する個々のパフォーマンス カウンターに設定される規則です。 カウンター セットの定義には、多数の重要なパフォーマンス カウンターに対する定義済みのしきい値規則が含まれています。 ロード テストのしきい値規則は、パフォーマンス カウンターの値を定数値または別のパフォーマンス カウンターの値と比較します。|-   [方法: しきい値規則を追加する](../test/how-to-add-a-threshold-rule-using-the-load-test-editor.md)|
|**カウンター セットの割り当て先となるコンピューターに表示名を割り当てる:** コンピューターにタグを割り当てることにより、簡単に識別できる名前をコンピューターに適用できるようになります。 このタグは、ロード テスト エディターのツリーの **[カウンター セットの割り当て]** ノードに表示されます。 また、このタグは Excel のレポートにも表示されるため、関係者がロード テストでコンピューターのロールを確認する際に役立ちます。たとえば、"ラボ 2 の Web サーバー 1" や "Phoenix オフィスの SQL Server 2" のようなタグを使用できます。<br /><br /> 詳細については、「[テストの比較または傾向分析に備えたロード テストの結果レポートの作成](../test/compare-load-test-results.md)」を参照してください。|-   [方法: コンピューター タグをカウンター セットのマップに追加する](../test/how-to-add-computer-tags-to-counter-set-mappings-using-the-load-test-editor.md)|

## <a name="use-counter-sets"></a>カウンター セットの使用

ロード テスト ツールは、カウンターを使用して長期間パフォーマンス データを収集およびグラフ化します。 カウンター データは、ロード テストの実行中に、ユーザーが指定した間隔で収集されます。 詳細については、「[方法: サンプル速度を指定する](../test/how-to-specify-the-sample-rate-for-a-load-test.md)」を参照してください。 カウンターは実行時に表示することも、*ロード テスト アナライザー*を使用してロード テストを実行した後で表示することもできます。

カウンター データは、サーバーおよびテストを実行するコンピューターで収集されます。 テストを実行する一連のエージェント コンピューターを設定した場合、カウンターはそれらのコンピューターでも収集されます。

割合、カウント、および平均の 3 つのカウンター カテゴリがあります。 たとえば、CPU 使用率の割合、SQL Server のロック カウント、1 秒あたりの IIS 要求などがあります。

![ロード テストのカウンター セット](../test/media/loadtestcountersets.png "LoadTestCounterSets")

個々の HTTP 要求のパフォーマンス データは、テストを実行するコンピューターによって報告されます。 たとえば、エージェント コンピューターなどです。 要求の場合、[最初のバイトを取得する平均時間]、[応答時間]、および [Requests/Sec] などのデータを監視できます。

Web サーバーでパフォーマンス データを簡単に収集するために、ロード テストで使用するテクノロジに基づいて、Visual Studio Enterprise には定義済みの名前付きカウンター セットも用意されています。 これらのセットは、IIS、ASP.NET、または SQL Server を実行するサーバーを分析する場合に役立ちます。 既定のカウンター セットで提供されていないカウンターは、ロード テスト エディターを使用して追加できます。 テストしているコンピューターまたはサーバーをロード テストに追加して、これらのコンピューターでリソースの利用状況を監視できるようにすることが重要です。 詳細については、「[方法: カウンター セットを管理する](../test/how-to-manage-counter-sets-using-the-load-test-editor.md)」を参照してください。

通常、ロード テストの実行の結果分析には、収集するデータ、しきい値規則の設定箇所、および測定単位がアプリケーションの特定の問題を反映するときに通知する方法を知るために、特定の領域に関するドメイン固有の知識が必要です。 詳細については、「[しきい値規則の挿入](../test/specify-counter-sets-and-threshold-rules-for-load-testing.md#SpecifyingCounterSetsThresholdRulesAboutThresholdRules)」を参照してください。

### <a name="performance-counter-sampling-interval-considerations"></a>パフォーマンス カウンターのサンプリング間隔に関する考慮事項

ロード テストの長さに基づいて、ロード テストの実行設定の **[サンプル速度]** プロパティについて適切な値を選択します。 既定値 (5 秒) のようにサンプル速度が小さいと、ロード テスト結果のデータベースに必要な容量が増えます。 長いロード テストでは、サンプル速度を増加すると、収集するデータ量を減らすことができます。 詳細については、「[方法: サンプル速度を指定する](../test/how-to-specify-the-sample-rate-for-a-load-test.md)」を参照してください。

次にサンプル速度のガイドラインを示します。

|ロード テスト継続時間|推奨サンプル速度|
|------------------------|-----------------------------|
|\< 1 時間|5 秒|
|1 ～ 8 時間|15 秒|
|8 ～ 24 時間|30 秒|
|> 24 時間|60 秒|

## <a name="store-performance-data"></a>パフォーマンス データの格納

ロード テストの実行中に、パフォーマンス カウンター データが収集され、*ロード テストの結果リポジトリ*に格納されます。 詳細については、「[ロード テストの結果リポジトリ内のロード テストの結果の管理](../test/manage-load-test-results-in-the-load-test-results-repository.md)」を参照してください。

## <a name="about-threshold-rules"></a>しきい値規則の挿入

*しきい値規則* とは、ロード テスト中にシステム リソースの使用率を監視する個々のパフォーマンス カウンターに設定される規則です。 カウンター セットの定義には、多数の重要なパフォーマンス カウンターに対する定義済みのしきい値規則が含まれています。 詳細については、「[カウンター セットを使用してロード テストのパフォーマンス カウンター データを分析する](../test/specify-counter-sets-and-threshold-rules-for-load-testing.md)」を参照してください。

## <a name="threshold-rules-and-levels"></a>しきい値の規則とレベル

ロード テストのしきい値規則を作成する場合は、次の 2 種類の規則から選択します。

定数の比較&mdash;パフォーマンス カウンターの値を定数値と比較します。

カウンターの比較&mdash;パフォーマンス カウンターの値を別のパフォーマンス カウンターの値と比較します。

しきい値規則を作成するときには、規則のレベルも設定します。 レベルには、警告しきい値と重大しきい値があります。 ロード テストの実行を表示すると、警告レベルのしきい値違反は黄色のシンボルで示され、重大レベルのしきい値違反は赤のシンボルで示されます。

## <a name="the-alert-if-over-property"></a>[しきい値を超えたときに警告] プロパティ

しきい値を超えると問題であることを示す場合は、**[しきい値を超えたときに警告]** プロパティを **True** に設定します。 たとえば、**[% プロセッサ時間]** に対してしきい値規則が設定されており、この値が 90 を超えたときに警告を受け取るには、規則の種類として **[定数の比較]** を使用し、**[重要なしきい値]** を 90 に設定し、**[しきい値を超えたときに警告]** を **True** に設定します。

しきい値を下回ると問題であることを示す場合は、**[しきい値を超えたときに警告]** プロパティを **False** に設定します。 たとえば、**[要求/秒]** に対してしきい値規則が設定されており、この値が 50 を下回ったときに警告を受け取るには、規則の種類として **[定数の比較]** を使用し、**[重要なしきい値]** を 50 に設定し、**[しきい値を超えたときに警告]** を **False** に設定します。

## <a name="see-also"></a>関連項目

- [方法: しきい値規則を追加する](../test/how-to-add-a-threshold-rule-using-the-load-test-editor.md)
- [しきい値規則違反の分析](../test/analyze-threshold-rule-violations-in-load-tests.md)